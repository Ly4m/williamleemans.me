---
import Layout from "../../layouts/Layout.astro";
import { getCollection, render } from "astro:content";
import type { CollectionEntry } from "astro:content";

const nowEntries = await getCollection("now");
const sortedEntries = nowEntries.sort(
  (a, b) => a.data.pubDate.getTime() - b.data.pubDate.getTime()
);

const latestEntry = sortedEntries[0];
const { Content } = latestEntry ? await render(latestEntry) : { Content: null };

const previousEntries = sortedEntries.slice(1);

const staggerRules = Array.from(
  { length: 100 },
  (_, i) =>
    `.wave-enter-content > *:nth-child(${i + 1}) { --stagger: ${i + 1}; }`,
).join("\n");
---

<Layout title="William Leemans — Now" ogImage="/og/home.jpg">
  <div class="max-w-2xl">
    <header class="py-8 md:py-12">
      <h1 class="font-space text-charcoal text-2xl tracking-tight md:text-3xl">
        Now
      </h1>
    </header>
    <main class="text-charcoal max-w-2xl">
      <p class="mb-8">
        Ce qu'il se passe dans ma vie en ce moment, inspiré par <a
        target="_blank"
        referrerpolicy="no-referrer"
        href="https://nownownow.com/about">nownownow.com</a
      >
      </p>

      {latestEntry && Content && (
        <article class="prose wave-enter-content mb-12">
          <Content />
        </article>
      )}

      {previousEntries.length > 0 && (
        <section class="mt-12 mb-40">
          <h2 class="font-space text-xl mb-4">Précédentes entrées</h2>
          <ul class="space-y-2">
            {previousEntries.map((entry) => (
              <li>
                <a
                  href={`/now/${entry.id}`}
                  class="text-charcoal hover:underline"
                >
                  {entry.data.title}
                </a>
              </li>
            ))}
          </ul>
        </section>
      )}
    </main>
  </div>
</Layout>

<style is:global set:html={staggerRules}></style>

<style>
  h2 {
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
  }

  p + p {
    margin-top: 1rem;
  }

  a {
    text-decoration: underline;
  }
</style>
